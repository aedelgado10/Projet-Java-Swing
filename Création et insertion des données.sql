DROP TABLE IF EXISTS Collaborateur CASCADE;
DROP TABLE IF EXISTS Administrateur CASCADE;
DROP TABLE IF EXISTS DROITS CASCADE;
DROP TABLE IF EXISTS Salle CASCADE;
DROP TABLE IF EXISTS MESSAGE CASCADE;
DROP TABLE IF EXISTS ETRE CASCADE;

CREATE TABLE Collaborateur(
	idCollab SERIAL NOT NULL,
	nomCollab VARCHAR,
	prenomCollab VARCHAR,
	pseudoCollab VARCHAR,
	mailCollab VARCHAR(50),
	mdpCollab VARCHAR(50),
	
	PRIMARY KEY (idCollab)
);

CREATE TABLE Administrateur (
	idAdmin SERIAL   NOT NULL,
	
	PRIMARY KEY (idAdmin) 
);

CREATE TABLE DROITS (
	idDroit SERIAL   NOT NULL,
	descriptionDroit VARCHAR(20),
	ecriture BOOL,
	lecture BOOL,
	changerDescSalon BOOL,
	
	PRIMARY KEY (idDroit)
);

CREATE TABLE Salle (
	idSalle SERIAL NOT NULL,
	type VARCHAR,
	descrSalle VARCHAR(50),
	titreSalle VARCHAR(50),
	dateCreaSalle DATE,

	PRIMARY KEY (idSalle)
);

CREATE TABLE MESSAGE (
	idMessage SERIAL NOT NULL,
	contenu VARCHAR(500),
	dateEnvoi DATE,
	heureEnvoi VARCHAR(20),
	afficheDansSalon BOOL,
	PRIMARY KEY (idMessage) ) ;

CREATE TABLE ETRE (idCollab BIGINT   NOT NULL,
idAdmin INT NOT NULL,
PRIMARY KEY (idCollab,
 idAdmin) ) ;

DROP TABLE IF EXISTS AVOIR_DROITS_DANS_SALLE ;
CREATE TABLE AVOIR_DROITS_DANS_SALLE (idCollab BIGINT   NOT NULL,
idDroit BIGINT NOT NULL,
idSalle BIGINT NOT NULL,
PRIMARY KEY (idCollab,
 idDroit,
 idSalle) ) ;

DROP TABLE IF EXISTS CREER ;
CREATE TABLE CREER (idAdmin INT   NOT NULL,
idSalle BIGINT NOT NULL,
PRIMARY KEY (idAdmin,
 idSalle) ) ;

DROP TABLE IF EXISTS AFFECTER ;
CREATE TABLE AFFECTER (idAdmin INT   NOT NULL,
idSalle BIGINT NOT NULL,
idCollab BIGINT NOT NULL,
PRIMARY KEY (idAdmin,
 idSalle,
 idCollab) ) ;

DROP TABLE IF EXISTS SE_CONNECTER ;
CREATE TABLE SE_CONNECTER (idCollab BIGINT   NOT NULL,
idSalle BIGINT NOT NULL,
etat VARCHAR(10) NOT NULL,
PRIMARY KEY (idCollab,
 idSalle) ) ;

DROP TABLE IF EXISTS ENVOYER ;
CREATE TABLE ENVOYER (idCollab BIGINT   NOT NULL,
idMessage BIGINT NOT NULL,
idSalle BIGINT NOT NULL,
PRIMARY KEY (idCollab,
 idMessage,
 idSalle) ) ;

ALTER TABLE ETRE ADD CONSTRAINT FK_ETRE_idCollab FOREIGN KEY (idCollab) REFERENCES Collaborateur (idCollab) ON DELETE CASCADE; 
ALTER TABLE ETRE ADD CONSTRAINT FK_ETRE_idAdmin FOREIGN KEY (idAdmin) REFERENCES Administrateur (idAdmin);
ALTER TABLE AVOIR_DROITS_DANS_SALLE ADD CONSTRAINT FK_AVOIR_DROITS_DANS_SALLE_idCollab FOREIGN KEY (idCollab) REFERENCES Collaborateur (idCollab) ON DELETE CASCADE;
ALTER TABLE AVOIR_DROITS_DANS_SALLE ADD CONSTRAINT FK_AVOIR_DROITS_DANS_SALLE_idDroit FOREIGN KEY (idDroit) REFERENCES DROITS (idDroit)  ON DELETE CASCADE;
ALTER TABLE AVOIR_DROITS_DANS_SALLE ADD CONSTRAINT FK_AVOIR_DROITS_DANS_SALLE_idSalle FOREIGN KEY (idSalle) REFERENCES Salle (idSalle)  ON DELETE CASCADE;
ALTER TABLE CREER ADD CONSTRAINT FK_CREER_idAdmin FOREIGN KEY (idAdmin) REFERENCES Administrateur (idAdmin)  ON DELETE CASCADE;
ALTER TABLE CREER ADD CONSTRAINT FK_CREER_idSalle FOREIGN KEY (idSalle) REFERENCES Salle (idSalle) ON DELETE CASCADE;
ALTER TABLE AFFECTER ADD CONSTRAINT FK_AFFECTER_idAdmin FOREIGN KEY (idAdmin) REFERENCES Administrateur (idAdmin) ON DELETE CASCADE;
ALTER TABLE AFFECTER ADD CONSTRAINT FK_AFFECTER_idSalle FOREIGN KEY (idSalle) REFERENCES Salle (idSalle) ON DELETE CASCADE;
ALTER TABLE AFFECTER ADD CONSTRAINT FK_AFFECTER_idCollab FOREIGN KEY (idCollab) REFERENCES Collaborateur (idCollab) ON DELETE CASCADE;
ALTER TABLE SE_CONNECTER ADD CONSTRAINT FK_SE_CONNECTER_idCollab FOREIGN KEY (idCollab) REFERENCES Collaborateur (idCollab) ON DELETE CASCADE;
ALTER TABLE SE_CONNECTER ADD CONSTRAINT FK_SE_CONNECTER_idSalle FOREIGN KEY (idSalle) REFERENCES Salle (idSalle) ON DELETE CASCADE;
ALTER TABLE ENVOYER ADD CONSTRAINT FK_ENVOYER_idCollab FOREIGN KEY (idCollab) REFERENCES Collaborateur (idCollab) ON DELETE CASCADE;
ALTER TABLE ENVOYER ADD CONSTRAINT FK_ENVOYER_idMessage FOREIGN KEY (idMessage) REFERENCES MESSAGE (idMessage) ON DELETE CASCADE;
ALTER TABLE ENVOYER ADD CONSTRAINT FK_ENVOYER_idSalle FOREIGN KEY (idSalle) REFERENCES Salle (idSalle) ON DELETE CASCADE;

INSERT INTO Collaborateur VALUES(1,'Delgado','Andres','admin','aoun@irit.fr','mdp');
INSERT INTO Collaborateur VALUES(2,'Pereira','William','will','desprats@irit.fr','mdp');
INSERT INTO Collaborateur VALUES(3,'El Moumin','Sofiane','sofiane','sofiane@stri.net','mdp');
INSERT INTO Collaborateur VALUES(4,'Keraghel','Nady','nady','nady@stri.net','mdp');

INSERT INTO Administrateur VALUES(1);

INSERT INTO ETRE VALUES(1,1);

INSERT INTO MESSAGE VALUES(1,'Nous avons un souci avec les L3 STRI, ils sont nuls en java....','2016/05/27','09:00','1');
INSERT INTO MESSAGE VALUES(2,'oh non, ne me dis pas Ã§a stp...','2016/05/27','09:18','1');

INSERT INTO Salle VALUES(1,'Public','Discussion Enseignants STRI','STRI','2016/05/26');

INSERT INTO DROITS VALUES(1,'Droit admin','1','1','1');
INSERT INTO DROITS VALUES(2,'Droit normal','0','1','0');
INSERT INTO DROITS VALUES(3,'Droit restreint','0','0','0');

INSERT INTO AVOIR_DROITS_DANS_SALLE VALUES(1,1,1);
INSERT INTO AVOIR_DROITS_DANS_SALLE VALUES(2,2,1);
INSERT INTO AVOIR_DROITS_DANS_SALLE VALUES(3,2,1);

INSERT INTO CREER VALUES(1,1);

INSERT INTO AFFECTER VALUES(1,1,1);
INSERT INTO AFFECTER VALUES(1,1,2);
INSERT INTO AFFECTER VALUES(1,1,3);

INSERT INTO SE_CONNECTER VALUES(1,1,'Online');
INSERT INTO SE_CONNECTER VALUES(2,1,'Online');
INSERT INTO SE_CONNECTER VALUES(3,1,'Online');

INSERT INTO ENVOYER VALUES(1,1,1);
INSERT INTO ENVOYER VALUES(2,2,1);
